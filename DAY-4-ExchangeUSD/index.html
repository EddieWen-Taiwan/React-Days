<!DOCTYPE html>
<html>
<head>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<meta name="description" content="React.js library" />
	<meta name="author" content="Eddie Wen | 溫奕書" />
	<meta name="URL" content="http://github.eddiewen.me/React-Days/DAY-4-ExchangeUSD/" />
	<meta name="image" content="https://facebook.github.io/react/img/logo_og.png" />

	<!-- Open Graph -->
	<meta property="og:site_name" content="React ExchangeUSD" />
	<meta property="og:title" content="React ExchangeUSD" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="http://github.eddiewen.me/React-Days/DAY-4-ExchangeUSD/" />
	<meta property="og:image" content="https://facebook.github.io/react/img/logo_og.png" />
	<meta property="og:description" content="React.js library" />

	<title>React ExchangeUSD</title>
	<link rel="Shortcut Icon" type="image/x-icon" href="https://facebook.github.io/react/img/logo_og.png" />

	<!-- google font - Lobster -->
	<link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>

	<!-- React.js -->
	<script type="text/javascript" src="../library/react.min.js"></script>
	<script type="text/javascript" src="../library/react-dom.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>

	<!-- jQuery -->
	<script type="text/javascript" src="../library/jquery.min.js"></script>

	<!-- my CSS -->
	<style type="text/css">
	.unit,.wrapper{width:70%;text-align:center}.unit,.wrapper,input{text-align:center}body,input{font-family:Lobster}.mark,input{display:inline-block}body{color:#202020}.unit{margin:120px auto;padding-bottom:20px;font-size:52px;border-bottom:1px solid #DCDCDC}.money::after{content:"(USD)";font-size:18px;color:#9D9D9D;margin-left:7px}.money.twd::after{content:"(TWD)"}.wrapper{margin:0 auto}input{width:40%;border:none;border-bottom:1px dashed #DCDCDC;padding:35px 0;font-size:32px;background-color:#F9F9F9}input:focus{outline:0}.mark{width:10%}
	</style>

</head>
<body>

	<div id="container"></div>

	<script type="text/babel">
		var Unit = React.createClass({
			render: function() {
				return (
					<div className="unit">
						<span className="usd money">1</span> = <span className="twd money">{this.props.rate}</span>
					</div>
				);
			}
		});

		var InputBox = React.createClass({
			getInitialState: function() {
				return { usd: '', twd: '' };
			},
			roundDollars: function(dollar) {
				return Math.round(dollar*100)/100;
			},
			changeDollars: function(e) {
				var target = e.target;
				if( target.id == "usd" )
					this.setState({ usd: target.value, twd: this.roundDollars(target.value*this.props.rate) });
				else
					this.setState({ usd: this.roundDollars(target.value/this.props.rate), twd: target.value });
			},
			render: function() {
				return (
					<div className="wrapper">
						<input id="usd" type="text" placeholder="USD" value={this.state.usd} onChange={this.changeDollars} />
						<div className="mark">
							<img src="compare_arrows.png" />
						</div>
						<input id="twd" type="text" placeholder="TWD" value={this.state.twd} onChange={this.changeDollars} />
					</div>
				);
			}
		});

		// All in this
		var Exchanger = React.createClass({
			getInitialState: function() {
				return { rate: '' };
			},
			componentDidMount: function() {
				$.getJSON( this.props.url, function(data) {
					this.setState({ rate: data.query.results.rate.Rate });
				}.bind(this));
			},
			render: function() {
				return (
					<div id="exchanger">
						<Unit rate={this.state.rate} />
						<InputBox rate={this.state.rate} />
					</div>
				);
			}
		});

		ReactDOM.render(
			<Exchanger url="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.xchange%20where%20pair%20in%20(%22USDTWD%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys" />, document.getElementById('container')
		);
	</script>

</body>
</html>